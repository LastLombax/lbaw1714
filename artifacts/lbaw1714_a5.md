# A5: Relational Schema, validation and schema refinement

 GROUP1714, 18/03/2018

* Daniel Ribeiro de Pinho - up201505302@fe.up.pt

* Francisco José Sousa Silva - up201502860@fe.up.pt

* Rui André Rebolo Fernandes Leixo - up201504818@fe.up.pt

* Vitor Emanuel Fernandes Magalhães - up201503447@fe.up.pt


## 1. Relational Schema

> The Relational Schema includes the relation schemas, attributes, domains, primary keys, foreign keys and other integrity rules: UNIQUE, DEFAULT, NOT NULL, CHECK.
> Relation schemas are specified in the compact notation:

| Relation reference | Relation Compact Notation                                            |
| ------------------ | -------------------------------------------------------------------- |
| R01                | Event_EventAdmin(__idEvent->Event__, __idEventAdmin->EventAdmin__)                       |
| R02                | Event_Member(__idEvent->Event__, __idMember->Member__)					 |
| R03		              | Comment(__idComment__, text **NN**, timestamp **NN**, idEvent->Event, idMember->Member) 				|
| R04		              | Ticket(__idTicket__, idTicketType->TicketType, idMember->Member) |
| R05		              | TicketType(__idTicketType__, type **NN**, price **CK price > 0 NN**, initialQuantity **CK initialQuantity > 0 NN**, availableQuantity **CK availableQuantity > 0 NN**, description) |
| R06                | Invoice(__idInvoice__, name, taxPayerNumber, adress, quantity **NN**, amount **NN**, date **NN**)   |
| R07                | Community(__idCommunity__, name **NN**, description **NN**, creationDate **NN**, imagePath, publicLink **UK**, isPublic **NN**) |
| R08                | Community_Member(__idCommunity->Community__, __idMember->Member__) |
| R09                | Community_CommunityCategory(__idCommunity->Community__, __idCommunityCategory->CommunityCategory__) |
| R10                | Community_CommunityAdmin(__idCommunity->Community__, __idCommunityAdmin->CommunityAdmin__)
| R11                | Member(__idMember__, name **NN**, username **NN**, password **NN**, birthdate **NN**, email **NN**, country, city, address, taxPayerNumber, about, profilePicture, registrationDate **NN**, sentEmailVerification **NN**, verifiedEmail **NN**, isWebSiteAdmin **NN**) |
| R12                | Friend(__idFriend1->Member__, __idFriend2->Member__, accepted **NN**) |
| R13                | CommunityAdmin(__idCommunityAdmin->Member__,) |
| R14                | CommunityCategory(__idCommunityCategory__, name **NN**)                                         |
| R15                | EventAdmin(__idEventAdmin->Member__)
| R16                | Report(__idReport__, timestamp, context **NN**, idCommunity->Community, idMember->Member, idEvent-Event, idComment->Comment) |
| R17                | Notification(__idNotification__, idCommunity->Community, idMember->Member, idEvent-Event, idComment->Comment) |
| R18                | Event(__idEvent__, name **NN**, description **NN**, imagePath, date **NN**, country **NN**, city **NN**, address **NN**, publicLink **UK**, isPublic **NN**, idCommunity->Community)                                         |
| R19                | EventCategory(__idEventCategory__, name **NN**)                                         |
| R20                | Event_EventCategory(__idEvent->Event__, __idEventCategory->EventCategory__)               |

## 2. Domains

The specification of additional domains can also be made in a compact form, using the notation:

| Domain Name | Domain Specification           |
| ----------- | ------------------------------ |
| Today	      | DATE DEFAULT CURRENT_DATE      |
| Priority    | ENUM ('High', 'Medium', 'Low') |


## 3. Functional Dependencies and schema validation

| **Table R01** (Event_EventAdmin)|
| ------------------------------- |
| **Keys**: { idEvent, idEventAdmin }|
| **Functional Dependencies**     |
| FD0101          | idEvent → idEventAdmin |
| FD0102          | idEventAdmin → idEvent |
| **Normal Form** | BCNF           |


| **Table R02**                   |
| ------------------------------- |
| **Keys**: { id }                |
| **Functional Dependencies**     |
| FD0201          | id → attribute |
| **Normal Form** | BCNF           |

| **Table R03**                            |
| ---------------------------------------- |
| **Keys**: { id1, attribute }             |
| **Functional Dependencies**              |
| FD0301          | {id} → {id2, attribute} |
| **Normal Form** | BCNF                    |

| **Table R04**                                   |
| ----------------------------------------------- |
| **Keys**: { (id1, id2) }                        |
| **Functional Dependencies**                     |
| FD0401          | {(id1,id2)} → {id3, attribute} |
| **Normal Form** | BCNF                           |

> If necessary, description of the changes necessary to convert the schema to BCNF.
> Justification of the BCNF.

## 4. SQL Code

The Boyce-Codd Normal Form (BCNF) was used since it is a slightly stronger database normalization method when compared to the 3NF, better ensuring that there are no anomalies when updating the tables.

A relational schema is said to be in the BCNF when, for each of its functional dependencies (X → Y), one of the following happens:

* X → Y is a trivial functional dependency (i.e. Y is contained within X)
* X is a superkey for the schema

[Link to raw in repository](https://raw.githubusercontent.com/LastLombax/lbaw1714/master/database.SQL?token=AYlAMTKol8Y9z7J3DGtv-ZwywPbYAf2Lks5atmNPwA%3D%3D)

```sql
/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5      */
/*  Created On : 17-mar-2018 14:33:45                   */
/*  DBMS       : PostgreSQL                             */
/* ---------------------------------------------------- */

Inserir
```

