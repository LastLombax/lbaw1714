# A5: Relational Schema, validation and schema refinement

 GROUP1714, 18/03/2018 

* Daniel Ribeiro de Pinho - up201505302@fe.up.pt 

* Francisco José Sousa Silva - up201502860@fe.up.pt 

* Rui André Rebolo Fernandes Leixo - up201504818@fe.up.pt 

* Vitor Emanuel Fernandes Magalhães - up201503447@fe.up.pt 
 
 
## 1. Relational Schema
 
> The Relational Schema includes the relation schemas, attributes, domains, primary keys, foreign keys and other integrity rules: UNIQUE, DEFAULT, NOT NULL, CHECK.
> Relation schemas are specified in the compact notation:
 
| Relation reference | Relation Compact Notation                                            |
| ------------------ | -------------------------------------------------------------------- |
| R01                | Table1(__id__, attribute NN)                                         |
| R02                | Table2(__id__, attribute → Table1 NN)                                |
| R03                | Table3(__id1__, id2 → Table2, attribute UK NN)                       |
| R04                | Table4((__id1__, __id2__) → Table3, id3, attribute CK attribute > 0) |
 
 
## 2. Domains
 
The specification of additional domains can also be made in a compact form, using the notation:
 
| Domain Name | Domain Specification           |
| ----------- | ------------------------------ |
| Today	      | DATE DEFAULT CURRENT_DATE      |
| Priority    | ENUM ('High', 'Medium', 'Low') |
 
 
## 3. Functional Dependencies and schema validation
 
> To validate the Relational Schema obtained from the Conceptual Model, all functional dependencies are identified and the normalization of all relation schemas is accomplished. Should it be necessary, in case the scheme is not in the Boyce–Codd Normal Form (BCNF), the relational schema is refined using normalization.
 
| **Table R01**                   |
| ------------------------------- |
| **Keys**: { id }                |
| **Functional Dependencies**     |
| FD0101          | id → attribute |
| **Normal Form** | BCNF           |
 
| **Table R02**                   |
| ------------------------------- |
| **Keys**: { id }                |
| **Functional Dependencies**     |
| FD0201          | id → attribute |
| **Normal Form** | BCNF           |
 
| **Table R03**                            |
| ---------------------------------------- |
| **Keys**: { id1, attribute }             |
| **Functional Dependencies**              |
| FD0301          | {id} → {id2, attribute} |
| **Normal Form** | BCNF                    |
 
| **Table R04**                                   |
| ----------------------------------------------- |
| **Keys**: { (id1, id2) }                        |
| **Functional Dependencies**                     |
| FD0401          | {(id1,id2)} → {id3, attribute} |
| **Normal Form** | BCNF                           |
 
> If necessary, description of the changes necessary to convert the schema to BCNF.
> Justification of the BCNF.
 
## 4. SQL Code

[Link to raw in repository](https://raw.githubusercontent.com/LastLombax/lbaw1714/master/database.SQL?token=AYlAMTKol8Y9z7J3DGtv-ZwywPbYAf2Lks5atmNPwA%3D%3D)  

```sql
/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 17-mar-2018 14:33:45 				*/
/*  DBMS       : PostgreSQL 						*/
/* ---------------------------------------------------- */

/* Drop Tables */

DROP TABLE IF EXISTS Comment CASCADE
;

DROP TABLE IF EXISTS Community CASCADE
;

DROP TABLE IF EXISTS CommunityAdmin CASCADE
;

DROP TABLE IF EXISTS CommunityCategory CASCADE
;

DROP TABLE IF EXISTS Event CASCADE
;

DROP TABLE IF EXISTS EventAdmin CASCADE
;

DROP TABLE IF EXISTS EventCategory CASCADE
;

DROP TABLE IF EXISTS Member CASCADE
;

DROP TABLE IF EXISTS Notification CASCADE
;

DROP TABLE IF EXISTS Report CASCADE
;

DROP TABLE IF EXISTS Ticket CASCADE
;

DROP TABLE IF EXISTS TicketPurchase CASCADE
;

/* Create Tables */

CREATE TABLE Comment
(
	idComment integer NOT NULL,
	text text NOT NULL,
	timestamp timestamp without time zone NOT NULL
)
;

CREATE TABLE Community
(
	idCommunity integer NOT NULL,
	name varchar(64) NOT NULL,
	description varchar(256) NOT NULL,
	creationDate date NOT NULL,
	imagePath path NULL,
	publicLink path NULL,
	isPublic boolean NOT NULL
)
;

CREATE TABLE CommunityAdmin
(
	idCommunityAdmin integer NOT NULL
)
;

CREATE TABLE CommunityCategory
(
	idCommunityCategory integer NOT NULL,
	name varchar(50) NULL
)
;

CREATE TABLE Event
(
	idEvent integer NOT NULL,
	name varchar(64) NOT NULL,
	description varchar(516) NULL,
	imagePath path NULL,
	date date NOT NULL,
	country varchar(50) NOT NULL,
	city varchar(50) NOT NULL,
	address varchar(100) NOT NULL,
	publicLink path NULL,
	isPublic boolean NOT NULL
)
;

CREATE TABLE EventAdmin
(
	idEventAdmin integer NOT NULL
)
;

CREATE TABLE EventCategory
(
	idEventCategory integer NOT NULL,
	name varchar(50) NOT NULL
)
;

CREATE TABLE Member
(
	idMember integer NOT NULL,
	username varchar(16) NOT NULL,
	password text NOT NULL,
	name varchar(50) NOT NULL,
	birthdate date NOT NULL,
	email varchar(50) NOT NULL,
	country varchar(50) NULL,
	city varchar(50) NULL,
	address text NULL,
	taxPayerNumber varchar(20) NULL,
	about varchar(256) NULL,
	profilePicture path NULL,
	registrationDate date NOT NULL,
	sentEmailVerification boolean NOT NULL,
	verifiedEmail boolean NOT NULL,
	isWebsiteAdmin boolean NOT NULL
)
;

CREATE TABLE Notification
(
	idNotification integer NOT NULL
)
;

CREATE TABLE Report
(
	idReport integer NOT NULL,
	timestamp timestamp without time zone NOT NULL,
	itemToReport varchar(50) NOT NULL,
	description text NOT NULL
)
;

CREATE TABLE Ticket
(
	idTicket integer NOT NULL,
	price double precision NOT NULL,
	type varchar(50) NOT NULL,
	initialQuantity integer NOT NULL,
	availableQuantity integer NOT NULL
)
;

CREATE TABLE TicketPurchase
(
	idTicketPurchase integer NOT NULL,
	quantity integer NULL
)
;

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE Comment ADD CONSTRAINT PK_Comment
	PRIMARY KEY (idComment)
;

ALTER TABLE Community ADD CONSTRAINT PK_Community
	PRIMARY KEY (idCommunity)
;

CREATE INDEX IXFK_Community_EventCategory ON Community (idCommunity ASC)
;

CREATE INDEX IXFK_Community_Member ON Community (idCommunity ASC)
;

ALTER TABLE CommunityAdmin ADD CONSTRAINT PK_Member
	PRIMARY KEY (idCommunityAdmin)
;

ALTER TABLE CommunityCategory ADD CONSTRAINT PK_CommunityCategory
	PRIMARY KEY (idCommunityCategory)
;

ALTER TABLE Event ADD CONSTRAINT PK_Event
	PRIMARY KEY (idEvent)
;

ALTER TABLE EventAdmin ADD CONSTRAINT PK_Member
	PRIMARY KEY (idEventAdmin)
;

ALTER TABLE EventCategory ADD CONSTRAINT PK_EventCategory
	PRIMARY KEY (idEventCategory)
;

ALTER TABLE Member ADD CONSTRAINT PK_Member
	PRIMARY KEY (idMember)
;

ALTER TABLE Notification ADD CONSTRAINT PK_Notification
	PRIMARY KEY (idNotification)
;

ALTER TABLE Report ADD CONSTRAINT PK_Report
	PRIMARY KEY (idReport)
;

ALTER TABLE Ticket ADD CONSTRAINT PK_Ticket
	PRIMARY KEY (idTicket)
;

CREATE INDEX IXFK_Ticket_Event ON Ticket (idTicket ASC)
;

CREATE INDEX IXFK_Ticket_Event_02 ON Ticket (idTicket ASC)
;

ALTER TABLE TicketPurchase ADD CONSTRAINT PK_TicketPurchase
	PRIMARY KEY (idTicketPurchase)
;

/* Create Foreign Key Constraints */

ALTER TABLE Ticket ADD CONSTRAINT FK_Ticket_Event_02
	FOREIGN KEY (idTicket) REFERENCES  () ON DELETE No Action ON UPDATE No Action
;
```

